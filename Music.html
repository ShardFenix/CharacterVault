<!DOCTYPE html>
<html>
<head>
<style>
.tab{
	font-size:20px;
	font-weight:bold;
	border: 2px solid #4c4c4c;
	background-color:#000;
	color:white;
	padding:6px 0px;
	margin-left:-8px;
	width:14%;
	display:inline-block;
	text-align:center;
	cursor:pointer;
	font-family: 'Cinzel Decorative';
	
	-webkit-touch-callout: none;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

.tab.activetab{
	background-color:#bb0000;
}

.leftitem {
    text-align: center;
    background-color: #f3c953;
    border: 1px groove black;
    margin: 2px;
    padding: 4px;
    font-size: 20px;
    cursor: pointer;
    transition: 0.15s ease all;
}

.leftitem:hover {
    background-color: #ffdc7b;
}

.slidecontainer {
    width: 100%;
}

.slider {
    -webkit-appearance: none;
    width: 100%;
    height: 15px;
    border-radius: 5px;
    background: #d3d3d3;
    outline: none;
    opacity: 0.7;
    -webkit-transition: .2s;
    transition: opacity .2s;
}

.soundItem{
	display:flex;
}

.soundItem span{
	display:block;
	flex: 1;
}

.soundItem .slider{
	flex: 2;
}

/*
.slider:hover {
    opacity: 1;
}

.slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 25px;
    height: 25px;
    border-radius: 50%;
    background: #4CAF50;
    cursor: pointer;
}

.slider::-moz-range-thumb {
    width: 25px;
    height: 25px;
    border-radius: 50%;
    background: #4CAF50;
    cursor: pointer;
}
*/
.dropbox {
    padding: 10px;
    border: 1px solid black;
    vertical-align: top;
    margin-top: 20px;
    min-height: 30px;
    background: linear-gradient(180deg, #ddd, #bbb);
}

.borderheader {
    margin-top: -24px;
    display: block;
    font-size: 24px;
    background: linear-gradient(180deg, #d8d8d8 45%, #d6d6d6 70%);
    width: fit-content;
    padding: 0px 10px;
}

.soundGroup {
    border: 1px solid black;
    padding: 5px;
}

.slider-row{
	margin: 8px 0px;
	display:flex;
	padding-right:8px;
}

.slider-row span{
	flex: 1;
}

.slider-row .slider{
	flex: 2;
}

.slider {
  position: relative;
  text-align: left;
  border: 1px solid gray;
  height: 0.6em;
}


.slider .handle {
	position: absolute;
    z-index: 2;
    width: 1.2em;
    height: 1.2em;
    background-color: #ffffff;
    border-radius: 50px;
}

.handle {
  top: -0.3em;
  margin-left: -0.6em;
}

.slider .range {
	position: absolute;
    z-index: 1;
    display: block;
    font-size: .7em;
    background-color: #00a200;
    top: 0;
    height: 100%;
}

.header {
    font-size: 24px;
    text-align: center;
}

div[ng-drop-target]{
	position:relative;
}

.overlay{
	width: 100%;
	height: 100%;
	background-color: rgba(255,255,255,0);
	transition: 0.3s ease all;
	position: absolute;
    margin: -10px 0 0 -10px;
	pointer-events:none;
}

div.drop-over>.overlay{
	background-color: rgba(255,255,255,0.3);
}

input[type="text"]{
    background-color: rgb(70, 70, 70);
    border: none;
    font-size: 16px;
    padding: 4px;
    color: #d6d6d6;
    outline: none;
}

input[type="text"]::placeholder{
	color: #b0b0b0;
}

div.button{
	box-shadow: 0 0 3px 1px #484848;
	padding: 8px 12px;
	background-color: #00a200;
	display: inline-block;
	cursor:pointer;
	color:white;
	transition: 0.3s ease all;
}
div.button:hover{
	background-color: #00b000;
}


.sidepalette .leftitem{
	display:inline-grid;
	padding:4px 8px;
}

.sidepalette{

}

.soundName{
	background-color:#ffdb77;
	padding:4px;
	border-radius:3px;
	position:relative;
}

div.sidePalette>div.title{
	font-size:24px;
	text-align:center;
	background-color:#a0a0a0;
	color: black;
}

div.column{
	vertical-align: top;
	margin: 0px 10px;
}
.delete {
    font-size: 24px;
    color: black;
    font-weight: bold;
    cursor: default;
    position: absolute;
    right: 5px;
    top: 0px;
}

.sidepalette {
    height: 45vh;
    box-shadow: 0 0 3px 1px #191919;
    background-color: #4a4a4a;
}

.sidepalette .title {
    color: white;
    font-size: 24px;
    padding: 2px 10px;
    background-color: black;
}

.scrollable{
	overflow-y: auto;
	max-height: calc(100% - 31px);
}

.playerContainer {
    background: white;
    width: 100%;
    height: 6px;
    margin: 10px 0px 20px 0px;
	position:relative;
}
.playerProgressBar {
    height: 6px;
    background: #00bf00;
    position: absolute;
}
.playerLoopTicks{
	width: 2px;
	height: 6px;
	margin-top: 6px;
	margin-left: -1px;
	position: absolute;
}
.playerLoopTicks.red{
	width: 2px;
	height: 6px;
	margin-top: 6px;
	margin-left: -1px;
	position: absolute;
}
.music-subtitle {
    text-align: left;
    border-top: 1px solid black;
    font-size: 0.8em;
}
.music-title{
	text-align:left;
}
</style>
<!--
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular-animate.js"></script>
-->
<script src="libs/jquery.min.js"></script>
<script src="libs/angular.min.js"></script>
<script src="libs/angular-animate.js"></script>
<script src="core/dragndrop.js"></script>

<script src="node_modules/audio-metadata/audio-metadata.min.js"></script>
</head>
<body style="background-color:#707070;">
<div ng-app="myApp">
<div ng-controller="MyController" ng-cloak>

<div style="display:flex">
	<div class="column" style="flex: 2;">
		<div class="button" ng-click="newEnvironment()">New Environment</div>
		<div class="button" ng-click="saveEnvironments()">Save All</div>
		<div ng-repeat="env in environments" class="leftitem" ng-click="loadEnvironment(env)">{{env.name}}</div>
	</div>
	<div class="column" style="min-width:450px;">
		<div ng-show="selectedEnvironment">
			<div>
				<input type="text" ng-model="selectedEnvironment.name" placeholder="Name"/>
			</div>
			<div class="dropbox" ng-drop-target on-drop="dropMusic(source,target)">
				<div class="overlay"></div>
				<span class="borderheader">Music</span>
				<div class="soundItem slider-row" ng-show="selectedEnvironment.music.name">
					<span>{{selectedEnvironment.music.name}}</span>
					<input type="range" min="0" max="1" step="0.01" value="0.5" class="slider" ng-model="selectedEnvironment.music.volume" ng-change="updateMusicVolume(selectedEnvironment.music.volume)">
				</div>
			</div>
			<div class="dropbox" ng-drop-target on-drop="dropLoop(source,target)">
				<div class="overlay"></div>
				<span class="borderheader">Loops</span>
				<div ng-repeat="loop in selectedEnvironment.loops" class="soundItem slider-row">
					<span class="soundName">{{loop.name}}
						<span class="delete" ng-click="deleteSfx(loop)">&times;</span>
					</span>
					<input type="range" min="0" max="1" step="0.01" value="0.5" class="slider" ng-model="loop.volume" ng-change="updateLoopVolume(loop)">
				</div>
			</div>
			<div class="dropbox" ng-drop-target on-drop="dropSfx(source,target)">
				<div class="overlay"></div>
				<span class="borderheader">SFX</span>
				<div ng-repeat="soundGroup in selectedEnvironment.oneShots" class="soundGroup" style="position:relative;">
					<span class="delete" ng-click="deleteSfx(soundGroup)">&times;</span>
					<div class="slider-row">
						<span>Interval: {{soundGroup.intervalMin}} - {{soundGroup.intervalMax}}</span>
						<range-slider min='1' max='200' discrete value-min="soundGroup.intervalMin" value-max="soundGroup.intervalMax" />
					</div>
					<div class="slider-row">
						<span>Volume</span>
						<range-slider min='0' max='1' step='0.01' value-min="soundGroup.volumeMin" value-max="soundGroup.volumeMax" />
					</div>
					<div ng-drop-target on-drop="dropSubSfx(source,target)">
						<div class="overlay"></div>
						<div class="header">Files</div>
						<div ng-repeat="file in soundGroup.files" class="soundItem">
							<span class="soundName">{{file.name}}
								<span class="delete" ng-click="deleteSfx(file)">&times;</span>
							</span>
							<input type="range" min="0" max="1" step="0.01" class="slider" ng-model="file.volume">
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="column" style="flex: 5;">
		<input type="range" min="0" max="1" step="0.01" ng-model="musicVolume" class="slider" ng-change="updateMusicVolume(musicVolume)">
		<br>
		<div class="playerContainer">
			<div class="playerLoopTicks" ng-repeat="tick in loopPoints" ng-style="position(tick)"></div>
			<div class="playerLoopTicks" ng-style="position(musicNode.loopStart)"></div>
			<div class="playerLoopTicks" ng-style="position(musicNode.loopEnd)"></div>
			<div class="playerProgressBar"></div>
		</div>
		<div class="leftitem" ng-click="stopMusic()">Stop Music</div>
		<br>
		<br>
		<table style="width:100%;"><tr>
			<td style="vertical-align:top;">
				<div class="leftmenu">
					<div class="leftitem" ng-repeat="folder in musicFolders" ng-click="openSecondaryFolder('Music/'+folder)">
						{{folder}}
					</div>
				</div>
			</td>
			<td style="vertical-align:top;">
				<div class="secondmenu">
					<div class="leftitem" ng-repeat="music in musicFiles" ng-click="loadMusic(music.filename)" ng-draggable>
						<div class="music-title">{{music.name}}</div>
						<div ng-if="music.album" class="music-subtitle">{{music.album}}</div>
					</div>
				</div>
			</td>
			</tr>
		</table>
	</div>

	<div class="column" style="flex: 5;">
		<div><input type="text" ng-model="paletteFilter" placeholder="Search"/></div>
		<div class="sidepalette">
			<div class="title">Loops</div>
			<div class="scrollable">
				<div ng-repeat="loop in loops | filter:paletteFilter" class="leftitem" ng-click="" ng-draggable>{{loop.name}}</div>
			</div>
		</div>
		<div class="sidepalette">
			<div class="title">Sound Effects</div>
			<div class="scrollable">
				<div ng-repeat="sfx in oneShots | filter:paletteFilter" class="leftitem" ng-click="playSound(sfx.filename)" ng-draggable >{{sfx.name}}</div>
			</div>
		</div>
	</div>
</div>


</div></div>

<script src="./core/music.js"></script>


</body>
</html>